\newpage

## OPERATE RUNNING SYSTEMS
# 17. Boot systems into different targets manually

---

### I. ACCESO AL SISTEMA DESDE GRUB

`[e]       # pulsar tecla 'e' en el menu de arranque`

> Permite editar línea de arranque linux, con el siguiente contenido típico

> `linux  ($root)/vmlinuz..     root=/dev/mapper/rhel-root`  
> `ro    crashkernel=...      resume=/dev/mapper/rhel-swap`  
> `rd.lvm.lv=rhel/root     rd.lvm.lv=rhel/swap   rhgb   quiet`

> las opciones `rhgb quiet` permiten mostrar en pantalla los mensajes mientras
> arranca el sistema, para conocer donde se detiene el inicio, etc..

`CTRL-x`

> Arranca el sistema con la configuración de grub actual

>

### II. ACCESO AL SISTEMA DESDE GRUB SIN CONTRASEÑA DE ROOT [EX200]

*INICIO CON ROOTFS MONTADO EN /sysroot (en GRUB, agregar al final de linux...)*

* `rd.break`

> Inicia en initramfs un Dracut Emergency Shell. Para trabajar aquí habrá que
> remontar `sysroot` en modo `rw` y cambiar la raíz (`chroot`) a `sysroot`

*INICIO CON ROOTFS MONTADO EN /  (en GRUB, agregar al final de linux...)*

* `init=/bin/sh`

> Inicia shell inmediatamente tras kernel e initramfs. Para trabajar hay que
remontar `/` en modo `rw`

>

### III. ACCESO AL SISTEMA DESDE GRUB CON CONTRASEÑA DE ROOT

*INICIO EN MODO EMERGENCIA (en GRUB, agregar al final de linux...)*

* `system.unit=emergency.target`
* `emergency`
* `-b`

> Inicia en modo emergencia, donde será necesario realizar estas operaciones
> (para un sistema BIOS):  

> `mount -o remount,rw /`  
> `mount /dev/vda1 /boot`  
> `PATH="$PATH":/sbin`  
> `grub2-mkconfig --update-bls-cmdline -o /boot/grub2/grub.cfg`  

*INICIO EN MODO RESCUE (en GRUB, agregar al final de linux...)*

* `systemd.unit=rescue.target`
* `rescue`
* `s`
* `1`

> Inicia en modo rescue

>

### IV. ACCESO AL SISTEMA SI GRUB NO INICIA

Iniciar con *Rescue/Installation disk*  

1. Primer intento: elegir **Troubleshooting > Boot from local drive**

2. Segundo intento: elegir **Troubleshooting > Rescue a Red Hat Linux System**

>

Una vez iniciado desde el *Rescue/Installacion disk* puede ser necesario,

1. cambiar la raiz para que funcionen los comandos,

> `chroot /mnt/sysimage`

> `chroot /mnt/sysroot`

> `exit; reboot`

> Cambia `/mnt/sysroot` a `/` de manera que funcionen los comandos. Abandona
> `chroot` mediante `exit` antes de reiniciar

2. instalar GRUB para arrancar grub

> `grub2-install /dev/vda`

> apunta al disco y no a la partición de /boot porque se tienen que escribir los
> 446 bytes en LBA0 (stage 1 de GRUB2)

3. reconstruir imagen de initramfs para el kernel actual

> `dracut --force`

> reconstruye imagen initramfs para el kernel actual, empleando ficheros en

> * `/usr/lib/dracut/dracut.conf.d/*.conf` ficheros de configuración por defecto 
> * `/etc/dracut.conf.d/` ficheros de configuración personalizados
> * `/etc/dracut.conf` fichero de configuración obsoleto


