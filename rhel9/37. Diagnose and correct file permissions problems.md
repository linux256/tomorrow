\newpage

## CREATE AND CONFIGURE FILESYSTEMS
# 37. Diagnose and correct file permissions problems

---

### I. COMANDOS DE BUSQUEDA DE FICHEROS Y DIRECTORIOS

**Ficheros y directorio por su propietario**

* `find / -type f -user  linda` busca ficheros del usuario propietario `linda`
* `find / -type d -user  linda` busca directorios de usuario propietario `linda`
* `find / -type f -group users` busca ficheros del grupo propietario `users`
* `find / -type d -group users` busca directorios del grupo propietario `users`

>

**Ficheros y directorios por sus permisos especiales**

* `find / -type f -perm -4000 -user  root` busca ficheros de root con SUID.  
*Si se ejecutan, lo harán con EUID=root*
* `find / -type f -perm -2000 -group root` busca ficheros del grupo propietario
`root` con SGID.  
*Si se ejecutan, lo harán con EGID=root*
* `find / -type d -perm -2000 -group grp1` busca directorios del grupo
propietario `grp1` con SGID.  
*Los ficheros que se creen dentro, tendran por defecto el grupo propietario
`grp1`*
* `find / -type d -perm -1000 -user usr1` busca directorios del propietario
root con STICKY BIT.  
*Los ficheros contenidos en este directorio solo los podrá borrar `root`, el
propietario del fichero o `usr1`*

### II. ACL

*El empleo de ACL permite ampliar los permisos basicos establecidos sobre u,g,o
para considerar permisos de acceso más granulares. Para su empleo es necesario
que el sistema de ficheros esté montado con la opción `acl`*

`getacl file.txt`

> Lista de control de acceso (ACL) de `file.txt`

`setfacl -m u:bob:rw  file.txt`

> Modifica la ACL de `file.txt` añadiendo permisos de lectura y escritura para
el usuario `bob`

`setfacl -x u:bob file.txt`

> Quita ACL del usuario `bob` al fichero `file.txt`

`setfacl -m d:u:bob:rw  mydir/`

> Agrega ACL a los nuevos ficheros que se creen en `mydir/` para que el usuario
`bob` tenga permisos `rw`. El empleo de `d` al comienzo de la ACL establece que
será una ACL por defecto para todos los ficheros creados en `mydir/`. Si se
aplicara la opción `-d` todas las ACL que se especificaran serían consideradas
ACL por defecto

### III. PROPIETARIOS

`chown  user  fichero`

> Fija el propietario de `fichero` a `user`

`chown  -R  user  directorio/`

> Fija recursivamente el propietario `user` a `directorio/` y su contenido

`chown  .grupo  fichero`  
`chown  :grupo  fichero`  

> Fija el grupo propietario de `fichero`

`chown  -R  :grupo  directorio/`

> Fija recursivamente el grupo propietario a `directorio/` y su contenido

`chown  user.grupo  fichero`  
`chown  user:grupo  fichero`

> Fija propietario y grupo propietario

### IV. GRUPOS

`groups`

> Muestra los grupos a los que pertenece el usuario, como `id`

`newgrp grupotemporal`

> Establece temporalmente, dentro de un nuevo subshell que se inicia, el grupo
efectivo primario del usuario (EGID) como `grupotemporal`. Para ello se necesita
que el usuario pertenezca a `grupotemporal` (como grupo secundario) o, en caso
de que no pertenezca a `grupotemporal`, que conozca la contraseña para unirse
al grupo temporalmente

`gpasswd  grupotemporal`

> Establece contraseña para unirse temporalmente a `grupotemporal` 

---

*Referencias*

* https://documentation.suse.com/sles/15-SP6/html/SLES-all/cha-security-acls.html


