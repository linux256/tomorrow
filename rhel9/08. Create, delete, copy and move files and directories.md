\newpage

## UNDERSTAND AND USE ESSENTIAL TOOLS
# 08. Create, delete, copy and move files and directories

---

### I. FHS (File System Hierarchy Standard)

```
/             /home            /proc          /sys
/boot         /mnt             /root          /tmp
/dev          /media           /run           /usr
/etc          /opt             /srv           /var
```

### II. MONTAJES

`/proc/mounts`

`/etc/mtab`

`/proc/self/mounts` 

> Muestra contenido de la tabla de filesystems montados, los dos primeros son
> enlaces a `/proc/self/mounts`

`mount`

> Enumera los filesystems montados

`findmnt`

> lista todos los filesystems montados, o busca a partir del dispositivo o del
> punto de montaje. Puede buscar en `/etc/mtab` o en `/etc/fstab`

`findmnt --fstab /boot`

> busca en `/etc/fstab` filesystem montado en `/boot`

`findmnt -t xfs`

> busca los filesystems montados de tipo `xfs`

### II. WILDCARD Y BRACE EXPANSION

* `*` *wildcard*, cualquier cantidad de caracteres
* `?` *wildcard*, un carácter cualquiera
* `[auo]` *wildcard*, caracteres "a", "u" y "o"
* `[a-u]` *wildcard*, caracteres "a", "b", "c", ... "u"
* `{a,u,o}` *brace expansion* expansión en línea para construir varias cadenas

> Ejemplo: `ls /etc/{a,e}*` es equivalente a `ls /etc/a* /etc/e*`

> Ejemplo: `rm [a-c]*` no da error si no hay ficheros que empiecen por `b`. Por
> el contrario `rm {a,b,c}*` se expande a `rm a* b* c*` y sí da error si no hay
> hay ficheros que empiecen por `b`

### III. CREAR, BORRAR DIRECTORIOS Y MOSTRAR SU CONTENIDO
`mkdir -p /dir1/dir2/`

> Forma preferida de usar mkdir donde se crea dir1 si no existe

`rmdir -p /dir1/dir2/`

> Intenta eliminar dir2 y dir1, que deben estar vacíos para poder ser borrados

`ls -halF -ritZ --group-directories-first --time-style=long-iso`

> Lista (`-a`) todos los ficheros , (`-l`) en formato largo, (`-h`) con tamaño
> en formato humano, (`-F`) agregando un simbolo segun tipo de fichero, (`-i`)
> mostrando numero de inode, (`-t`) ordenado cronológicamente (`-r`) al revés
> (de mas antiguo a más reciente), y (`-Z`) mostrando el contexto SELinux,
> agrupando los directorios al comienzo y con fecha aaaa-mm-dd hh:mm

`alias 'll=ls -halF'`

`alias 'lll=ls -halF -ritZ --group-directories-first --time-style="+%F %T"'`

`alias 'lld=ll -d */'`

> Alias de interés para mostrar sucesivos niveles de información (en `lll` se
> muestra la hora con segundos) y para mostrar solo los directorios con `lld`

### IV. ENCONTRAR FICHEROS

**`find  starting-point  test-match-files  operation`**

> Forma general de comando `find` para localizar ficheros en una ubicación que
> cumplan una condicion y realizar alguna acción sobre ellos. Empleado junto a
> `xargs` se amplian capacidades

*Opciones para test-match-files*

* `-name '*.c'` búsqueda en base al nombre (*wildcards*) que no debe incluir
el caracter `/` para indicar directorios (ver `-path`)
* `-path '/etc/a*'` busca nombres considerando la ruta absoluta
* `-type d` busca ficheros que sean directorios
* `-type f` busca ficheros 
* `-type l` busca ficheros que sean enlaces simbólicos
* `-size 0` busca ficheros vacios
* `-mmin 5` busca ficheros modificados hace menos de 5 minutos
* `-user lucy` busca ficheros donde el propietario sea `lucy`
* `-context *krb5_conf_t*` busca ficheros con el context type `krb5_conf_t`
* `-perm 4755` busca ficheros que tengan **exactamente** el permiso 755+SUID
* `-perm -4700` busca ficheros que tengan **al menos** los permisos 700 y SUID
* `-perm /4700` busca ficheros que tengan **cualquiera** de estos permisos

*Acciones para ejecutar*

* `-print` imprime en STDOUT el nombre del fichero, es la accion por defecto
* `-fprintf file` escribe en file el nombre del fichero
* `-exec cmd` ejecuta cmd: `find -u bob -type f -exec cp --parents '{}' /bck \;`

`xargs`

> Permite ejecutar un mismo comando para un grupo de archivos. Se usa tras `|`
> normalmente.

> Ej: `echo file1 file2 file3 | xargs touch`  crea multiples ficheros

> Ej: `find /tmp -name 'core*' -type f | xargs /bin/rm -f` borrado multiple

`xargs -d ':' -n 1 -t`

> Separa (`-d`) los argumentos con `:` en lugar de espacio, permite usar como
> (`-n 1`) maximo 1 argumento por comando y muestra (`-t`) el comando antes de
> ejecutarlo

### V. COPIAR, ARCHIVAR Y BORRAR FICHEROS

`cp -R student/*  /tmp/test1/`

> Copia en `/tmp/test1/` los ficheros y directorio visibles, recursivamente

`cp -R student/.  /tmp/test1/`

> Copia en `/tmp/test1/` todos los ficheros y directorio, visibles y ocultos

`cp -R /home/student/nivel1/nivel2/nivel3/  /tmp/test1/`

`cp -R nivel3/  /tmp/test1/`

`cp -R nivel3   /tmp/test1/`

> Copia en **`/tmp/test1/nivel3/`** todos los ficheros/dir. visibles y ocultos.
> Es como `cp -R student/.` pero *crea un directorio para la copia*

`cp -a student/*  /tmp/test1/`

> archiva en `/tmp/test1/` los ficheros y directorio visibles. Al archivar se
> preserva propietario, permisos, fechas y contexto

`cp -a student/.  /tmp/test1/`

> archiva en `/tmp/test1/` todos los ficheros y directorio, visibles y ocultos

`cp -a student/   /tmp/test1/`

> archiva en `/tmp/test1/student/` todos los ficheros/dir., visibles y ocultos

`rm -r`

> Borrado recursivo

`rm -f`

> Borra sin preguntar

`rm -i`

> Pregunta en cada borrado

`rm -d`

> Borra directorios si están vacíos

`rm -rf *`

> Borra todos los ficheros visibles

`rm -rf * .*`

> Borra todos los ficheros visibles y los ocultos

`rm -- -foo`

> Con la opción `--` se informa que se han terminado las opciones, por lo que
> `-foo` se interpreta como un nombre de fichero, no como una opción


