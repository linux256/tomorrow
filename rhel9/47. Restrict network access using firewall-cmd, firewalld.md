\newpage

## MANAGE BASIC NETWORKING
# 47. Restrict network access using firewall-cmd, firewalld

---

### I. NETFILTER

**Netfilter** es el subsistema del kernel Linux que permite a otros modulos del
kernel inspeccionar y modificar el trafico entrante, saliente o reenviado 
(*forwarded*)

### II. IPTABLES, NFTABLES

**iptables** es el servicio original para configurar *Netfilter* a través del
comando `iptables`

`iptables -L`

> Lista las reglas en todas las cadenas (`INPUT`, `OUTPUT`, `FORWARD`)ç

**nftables** es el servicio que reemplaza a *iptables* para configurar
*Netfilter* a través del comando `nft`

### III. FIREWALLD

**firewalld** es el servicio *actual* para gestionar *Netfilter* con los
comandos `firewall-cmd` y `firewall-config` (GUI). Por defecto NO se filtra ningún tráfico saliente. Se apoya en ZONAS, REGLAS y SERVICIOS

>

**ZONE** Representan un nivel de confianza en las conexiones de red, lo que se
traduce en que una zona define que un conjunto de funciones de firewall estén
habilitadas. De manera simplificada, una zona es un conjunto de reglas
aplicadas a los paquetes entrantes (1) desde una dirección origen específica o
(2) desde un interfaz de red específico. La zona a la que correspende un paquete 
se determina en este orden de prioridad,

* pertenece a una zona específica, según SOURCE ADDRESS
* pertenece a una zona específica, según INCOMING NETWORK INTERFACE
* en otro caso, pertenece a DEFAULT ZONE

Por defecto existen zonas predefinidas, de menor a mayor nivel de confianza:

* DROP cualquier paquete entrante se descarta sin mas. Solo se permiten las
conexiones salientes
* BLOCK solo se permiten las conexiones entrantes iniciadas en el sistema, las
demas se rechazan dando un mensaje de respuesta
* PUBLIC, **zona por defecto para los nuevos interfaces de red creados si no se
ha establecido otra zona por defecto**. Solo se aceptan conexiones entrantes
seleccionadas.
* EXTERNAL, solo se permiten conexiones entrantes seleccionadas
* DMZ, para equipos en zona desmilitarizada, que son públicamente accesibles y
con acceso limitado a la red interna. Solo se permiten conexiones entrantes
seleccionadas.
* WORK, para uso en áreas de trabajo donde mayoritariamente se confía en los
demás equipos de la red. Solo se permiten conexiones entrantes seleccionadas.
* HOME, para uso en área doméstica donde mayoritariamente se confía en los
demás equipos de la red. Solo se permiten conexiones entrantes seleccionadas.
* INTERNAL, para uso en redes internas donde mayoritariamente se confía en los
demás equipos de la red. Solo se permiten conexiones entrantes
seleccionadas.
* TRUSTED, se aceptan TODAS las conexiones

>

**SERVICES** Puertos que se abren y módulos del kernel que se deben cargar,
definidos en ficheros .XML

`/usr/lib/firewalld/services/`  
`/etc/firewalld/services/`  

> Ubicaciones de los ficheros de definición de servicios (v.g. `ftp.xml`)

---

*Referencias*

* https://wiki.nftables.org/wiki-nftables/index.php/Quick_reference-
nftables_in_10_minutes


