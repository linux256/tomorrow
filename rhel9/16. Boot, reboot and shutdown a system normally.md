\newpage

## OPERATE RUNNING SYSTEMS
# 16. Boot, reboot and shutdown a system normally

---

### I. HALT VS POWEROFF. SYSTEMCTL Y SHUTDOWN

`systemctl halt`

`halt`

> Detiene el sistema operativo, pero la máquina (física o virtual) puede seguir
> encendida. `halt` es un enlace simbólico a `systemctl`

`systemctl poweroff`

`poweroff`

> Detiene el sistema operativo y apaga la máquina, haciendo uso de las funciones
> de *power managenment* de la placa base del equipo. `poweroff` es un enlace
> simbólico a `systemctl`

`shutdown  -H|-P|-r  01:30 "El sistema se detendrá en 1 hora 30 minutos"`

> Detiene o apaga la máquina según la opción **modo** dentro de 1 hora y 30 min
> advirtiéndolo a los usuarios mediante un mensaje **`wall`**. Las opciones son,

* `shutdown -H now`  *halt* del sistema operativo ahora
* `shutdown -P 1`  *poweroff* de la máquina dentro de 1 minuto
* `shutdown -r now` *reboot* de la máquina ahora
* `shutdown -c` **cancela** la operación que pueda estar programada

### II. REBOOT, SUSPEND, HIBERNATE

`systemctl reboot`

`reboot`

> Reinicia la máquina. `reboot` es un enlace simbólico a `systemctl`

`systemctl suspend`

> Suspende la máquina, dejando en RAM el contenido de la memoria

`systemctl hibernate`

> Hiberna la máquina, pasando a disco el contenido de la memoria para proseguir
> al reiniciarla. Puede ser práctico para realizar un snapshot de una máquina
> virtual estando apagada y retomar su estado de ejecución al revertirlo

`systemctl hybrid-sleep`

> Pasa a disco el estado de la memoria RAM y lo mantiene en RAM para recuperar
> la actividad con más rapidez. También se denomina *suspend-to-both* porque es
> una combinación de hibernación (suspension a disco) y suspensión (suspensión a
> RAM).

### III. CODIGOS DE PETICIONES DE SISTEMA. OPERACIONES DE EMERGENCIA

*Mediante la tecla [PetSis] o [SysRq] se pueden solicitar códigos de ejecución
directos al kernel del sistema operativo, para maniobrar la máquina*

`sysctl -w kernel.sysrq=1`

> Activa la captura y procesamiento de SysRq desde teclado

*pulsar* `[ALT+SysRq]` ***NO soltar ALT*** *, soltar SysRq, pulsar* `[tecla]`

> Envía SysRq pulsado, con este significado:

> * `h` muestra ayuda de los códigos disponibles
> * `i` envía `kill` a todo salvo a `systemd`, produce un entorno limpio nuevo
> * `l` envía `kill` a todos los procesos, incluso `systemd` dejando el sistema
> inusable (hay que hacer poweroff)
> * `k` mata todos los procesos del terminal para asegurar que el login procede
> de `init` y no de un virus. Se denomina tecla de *secure access kill*

>

> * `u` *unmount* de todos los filesystems, y los monta en modo "solo-lectura"
> * `s` *sync* de todos los discos conectados al sistema
> * `o` *poweroff* del equipo
> * `b` *reboot* enviado al kernel directamente, sin desmontar filesystemas ni
> sincronizar discos, por lo que puede haber perdida de información no guardada

>

`echo b > /proc/sysrq-trigger`

> produce *reboot* inmediato, sin grabar nada, equivalente a `ALT+SysRq+b`

---
*Referencias*

* https://codigounix.blogspot.com/2011/10/linux-kernel-sysrq-and-sak-key.html


