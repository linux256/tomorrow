\newpage

## CREATE AND CONFIGURE FILESYSTEMS
# 34. Configure autofs

---

### I. AUTOFS

*Sistema clásico de montaje automático de sistemas de ficheros en red SMB y NFS.
Funciona bajo demanda y ofrece funcionalidad wildcard (no ofrecida por systemd).
En **systemd** se emplean **units automount**, que no incorporan wildcard. La
capacidad "Automount" requiere del servicio "autofs" que opera en "user space"
sin necesidad de permisos `root`. Por el contrario, `mount` necesita ser `root`*

`dnf install autofs`

`/etc/auto.master/`

> Fichero master de definición de `autofs` que asocia un directorio raiz de
> montaje con un fichero mapa (que detalla los *shares*  a montar). Tiene esta
> sintáxis (las dos primeras líneas con map indirecto),

> > `/raizmontaje     /etc/auto.raizmontaje`  
> > `/mnt/datos       /etc/auto.datos`  
> > `/-               /etc/auto.files`

> La entrada `/-` define que la raiz de montaje se indica en `/etc/auto.files`
> (map directo)

> *Nota (ver epígrafe "30"): los ficheros de los 'mount unit' se nombran
separando con '-' los subdirectorios de montaje
(`/etc/systemd/system/mnt-midir.mount`). Según `man 5 auto.master` no es
necesario separar con '-' los directorios de la raíz del montaje. No usar
`/etc/auto.mnt-datos` sino usar `/etc/auto.datos`*

`/etc/auto.datos`

> Fichero de definición de `autofs`, que define los subdirectorios dentro de
> `/mnt/datos/` y las opciones con que montar los *shares*,

> > `user1     -rw   serverNFS:/share1`  
> > `user2     -rw   serverNFS:/share2`

> > Monta en `/mnt/datos/user1` el *share* `serverNFS:/share1`  
> > Monta en `/mnt/datos/user2` el *share* `serverNFS:/share2`

>

### II. WILDCARD [EX200]

*Sistema donde se crea automáticamente el directorio para el montaje sin conocer
a priori su nombre, lo que lo hace útil por ejemplo para sub directorios `home`*

**Contenidos de los ficheros de configuración de autofs**

`/etc/auto.master`
 
> `/home    /etc/auto.home`

`/etc/auto.home`

> `*     -rw     serverNFS:/users/&`
 
Monta en `/home/`*`nombre`* los *share* de `serverNFS:/users/`*`nombre`*. El
empleo de `&` hace referencia al nombre de cada *share* individual


---

*Referencias*

* https://docs.redhat.com/es/documentation/red_hat_enterprise_linux/8/html/
managing_file_systems/the-autofs-configuration-files_assembly_mounting-file-
systems-on-demand#the-autofs-configuration-files_assembly_mounting-file-systems
-on-demand


