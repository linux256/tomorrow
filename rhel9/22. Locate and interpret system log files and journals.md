\newpage

## OPERATE RUNNING SYSTEMS
# 22. Locate and interpret system log files and journals

---

### I. SERVICIOS DE LOG

`systemd-journald`

> Servicio de referencia de registro de logs, que se pueden consultar desde
> `journalctl` o cuando se consulta `systemctl status unit`. Por defecto el
> *journal* no es persistente entre reinicios, motivo por el cual los registros
> de `journald` se redirigen también a `rsyslogd`

`rsyslogd`

> Servicio mejorado de `syslogd` que registra los logs en `/var/log/`. Ofrece
> funcionalidades que no ofrece `systemd-journald` como registro centralizado y
> procesado de registros en base a modulos. Para que una aplicación use el
> servicio de registro de syslog, se configura que debe entregar sus eventos al
> servidor syslog, categorizados como pertenecientes a una facility y con una
> prioridad determinada. El 'cómo' se establezca la *facility* y *priority* de
> los mensajes que mande al servidor syslog, depende de cada aplicación (suele
> definirse fichero tipo /etc/...conf).  

`auditd`

> Servicio de registro de eventos de auditoría, consultable con `ausearch`

### II. RSYSLOGD

Los ficheros de logs empleados son los siguientes, todos en **`/var/log/`** :

* `messages` registro genérico
* `dmesg` registros del kernel
* `secure` registros de autenticación
* `maillog` registros de correo electrónico
* `httpd` registros de servidor HTTP Apache
* `boot.log` registros de inicio del sistema
* `audit/audit.log` registros de eventos de auditoría y SELinux

`man 5 rsyslog.conf`

> Ayuda sobre el fichero de configuracion de `rsyslogd`. Los mensajes de syslog
> se registran categorizados en base a una **facility** y a una **priority**.
> Las *facilities* son,

* `auth/authpriv`, `cron`, `daemon` facility genérico
* `kern`, `lpr`, `mail`, `mark`
* `news`, `security`, `syslog`, `user`
* `uucp`, `local0`, `local1`, `local2`,...`local7` disponibles para el usuario

Las *priorities*son, de menor a mayor criticidad,

* `debug` información de depuración de una acción
* `info` mensaje meramente informativo
* `notice` situación normal, pero que resulta relevante ser notificada
* `warn` situación que no es errónea, pero que conduce a un error si no se realiza la accion requerida
* `err` error producido, no urgente ni precisa acción inmediata
* `crit` condición crítica que requiere una acción inmediata
* `alert` condición que requiere una correccion inmediata o el sistema quedará
fuera de servicio
* `emerg` sistema no usable, fuera de servicio. Parada de servicio o situación
de pánico

`/etc/rsyslog.conf`

> Fichero de configuración por defecto de `rsyslogd`. Ejemplo de entrada:  
> `*.info; mail.none; cron.=debug    -/var/log/mifichero`  
> `*.info`: mensajes de todas las facilities, de nivel `info` o superior  
> `mail.none`: ningún mensaje de la facility mail  
> `cron.=debug`: mensajes de cron de `debug` exclusivamente  
> `-/var/...`: el carácter `-` indica NO escribir inmediatamente  

`/etc/rsyslog.d/`

> Ficheros de configuración específicos de los distintos paquetes RPM instalados

`logger -p facility.priority mensaje`

> Registra (según la facility y prioridad) el mensaje correspondiente. Junto al
uso `journalctl -f --facility=.... --priority=....` facilita depurar scripts.
> Ejemplos:  

> * `logger -p kern.err  "mensaje de prueba"` escribirá normalmente en `dmesg`

> * `logger -p daemon.info "mensaje"`, escribirá donde esté definido para esa
*facility.priority*  

### III. JOURNALCTL

`systemd-journald`

> Servicio de *journaling*

`/run/log/journal/`

> Ruta donde se almacena el fichero, binario, con los registros de *journal*

`journalctl`

> Comando que lee, filtra y muestra `/run/log/journal/` usando el PAGER `less`

`journalctl --no-pager` 

> Muestra el *journal* sin emplear el paginador `less`

`journalctl -n 20`

> Muestra los últimos 20 mensajes del *journal*

`journalctl -p err`

> Muestra los mensajes de prioridad=error

`journalctl --facility=local0 --priority=alert`

> Muestra mensajes de una `facility.priority` específica

**`journalctl -u sshd`**

> Muestra mensajes de la *unit* `sshd.service`

`journalctl _SYSTEMD_UNIT=sshd.service`

> Muestra mensajes de la *unit* `sshd.service`

`journalctl --dmesg`

> Muestra mensajes del kernel

`journalctl --list-boots`

> muestra los *boots* para los que se dispone de *journal*, con un ID, fecha y
hora de inicio y fin

`journalctl -b ID`

> Muestra mensajes del boot ID, o del boot actual si no se especifica ningún ID

`journalctl _PID=1`

> Muestra mensajes del proceso con PID=1

**`journalctl -x`**

> Muestra informacion adicional de los mensajes

`journalctl -o verbose`

> Muestra información del registro en el journal

`journalctl --since 2025-01-15 14:50:00 --until today`

> Muestra informacion del registro para el periodo temporal definido


