\newpage

## MANAGE BASIC NETWORKING
# 44. Configure IPv4 and IPv6 addresses

---

### I. DIRECCIONES L3 (IP) Y L2 (LINK)

**IPv4 address** 4 bloques de 8 bits, mostrados en decimal separados por ".".
Una dirección IP = dirección de RED + dirección de HOST, donde la dirección de
RED es la parte fundamental y la dirección de HOST distingue al host dentro de
la red. La direccion de RED es común a todos los hosts de la red. Por ejemplo
una dirección IP es 192.168.10.34 con direccion de RED 192.168.10.0 y direccion
de HOST 34. La misma dirección IP podría corresponder a la dirección de red
192.168.0.0 y dirección de HOST 10.34; por eso la dirección de red es la parte
fundamental. La mascara de subred o notación CIDR (ClasslessInterDomainRouting)
determina que parte de la dirección es RED y que parte es HOST. En el ejemplo,
la máscara de subred puede ser 255.255.255.0 o en CIDR 192.168.10.0/24. La
dirección mas alta de una red se reserva como dir. de broadcast 192.168.10.255

**IPv6 address** 8 bloques de 16 bits, mostrados en hexadecimal, separador ":".
Por ejemplo 2fb::90ff:fe23:8998:112d (02fb:0000:0000:90ff:fe23:8998:112d)

**Direcciones de subred**

* `  X.  0.  0.  0 /  8          direcciones clase A, 24 bits para HOST`
* `  Y.  Y.  0.  0 / 16          direcciones clase B, 16 bits para HOST`
* `  Z.  Z.  Z.  0 / 24          direcciones clase C,  8 bits para HOST`

**Direcciones de red privadas**

* ` 10.  0.  0.  0 /  8     1 red clase A o 256 clase B o 65536 clase C`
* `172. 16.  0.  0 / 12                      16 clase B o  4096 clase C`
* `192.168.  0.  0 / 16                       1 clase B o   256 clase C`
* `-----------------------------------------273 clase B o 69888 clase C`

**Variable length subnet mask** Consiste en emplear parte de un byte para la red
y parte para el host, como sucede en la red privadas 172.16.0.0/12 donde hay 4
bits del segundo byte para la red (0001) y los 4 bits restantes xxxx se añaden a
los 16 restantes para los hosts. Se pueden definir subredes mas pequeñas, usando
parte de los bits de los hosts para añadirlos a la red (172.31.0.0/16). Por
ejemplo `212.209.113.35/27  (2^(32-27)=2^5=32 direcciones => 212.209.113.32/27
red + 30 hosts + 212.209.113.63 bdcast)` (/27=>conservar 3 primeros bits de 35
en hexadecimal: 128|64|**32**|...)

**MAC (Media Access Control) address** 6 bloques de 8 bits, mostrados en hexa
decimal, separador ":". Es una direccion de capa 2 del interfaz de red. Por
 ejemplo `52:54:00:18:b0:30`

### II. COMANDO IP

`ip link show`

> Muestra información de capa 2

`ip -s link show`

> Muestra estadísticas de capa 2, para conocer colisiones, errores, dropped..

`ip address show`

> Muestra informacion de capa 3

`ip route show`

> Muestra informacion de enrutamiento, para alcanzar redes distintas a la propia

`ss -ltu`

> Muestra información de capa 4: puertos a la escucha de TCP y UDP

**Conectar interfaz de red, asignarle dirección IP y gateway por defecto**

* `ip link  set  dev ens33  up`
* `ip addr  add  192.168.0.23/24  dev ens33`
* `ip route add  default via 192.168.1.1  dev ens33`

### III. NETWORK MANAGER : NMCLI, NMTUI

`systemctl status NetworkManager`

> Estado del servicio de red *network manager*, forma recomendada para
configurar la red en RHEL 9

**`nmcli general permissions`**

> Lista permisos del usuario. Salvo en el caso de `root`, en general por SSH no
hay permisos pero iniciando sesión local sí, siguiendo la regla \*unix de que
quien tiene acceso físico al sistema puede administrarlo.

**`nmcli networking off && nmcli networking on`**

> Carga la configuración que cargaría un reinicio del host, como un reboot. Esto
**no se logra** con `systemctl restart NetworkManager`

`nmcli`

`nmtui`

> Aplicaciones principales que gestionan *connections* que se asignan a los
*devices*. Un perfil *connection* es una configuración usada en un *device*, y
un *device* es un *network interface card*

**DEVICES**

`nmcli dev help`

> Ayuda sobre los comandos para gestionar *devices*

`nmcli dev status`

> Estado general de los *devices* que muestra la *connection* asignada

`nmcli dev show enp1s0`

> Detalle de los parámetros del *device*

`nmcli dev connect enp1s0`

`nmcli dev disconnect enp1s0`

> Desconecta el *device* indicado


**CONNECTIONS**

`/etc/NetworkManager/system-connections/ens160.nmconnection`

> Perfil persistente de conexión, en formato keyfile, donde se almacenan todos
los parámetros de configuración de la conexión.
*Si se edita manualmente se debe recargar con* **`nmcli con reload`**. *Quedan
en desuso las configuraciones `ifcgf` de `/etc/sysconfig/network-scripts/`*

`man nm-settings-keyfile`

> ayuda sobre los parámetros de configuracion de los perfiles `.nmconnection`

`nmcli con help`

> Ayuda sobre los comandos para gestionar *connections*

`nmcli con show`

> Muestra todas las *connections*

`nmcli con show enp1s0`

> Muestra detalle de *connection* `enp1s0`

`man nm-settings`

> Información detallada de todos los parámetros de un *connection*

`man nmcli-examples`

> Ejemplos de uso de `nmcli`

>

**CREAR CONEXIONES  `[ CON-NAME > TYPE > IFNAME > IPV4.METHOD > AUTOCONNECT ]`**

**Crear connection con IP dinámica para el device enp1s0**

```
nmcli con add  \
               con-name mdhcp          type ethernet        \
               ifname enp1s0           ipv4.method auto     \
               autoconnect yes
```

**Crear connection con IP estática para el device enp1s0**

```
nmcli con add  \
               con-name mstat          type ethernet        \
               ifname enp1s0           ipv4.method manual   \
               ip4 192.168.10.65/24    gw4 192.168.10.1/24  \
               autoconnect no
```

>

**MODIFICAR CONEXIONES**

`nmcli con mod mstat    ipv4.dns  8.8.8.8`  
`nmcli con mod mstat   +ipv4.dns  4.4.4.4`

> Cambia o añade (`+`) un servidor DNS a la *connection*

`nmcli con mod mstat    ipv4.addresses  192.168.0.31`  
`nmcli con mod mstat   +ipv4.addresses  192.168.0.32`

> Cambia o añade (`+`) una dirección IP4 de la *connection* 

>

**ACTIVAR/DESACTIVAR/BORRAR CONEXIONES**

`nmcli con down midin`

> Desactiva la *connection* `midin` e impide que se autoconecte si estuviera
configurada para ello.  
*Si el device tiene otra connection con `autoconnect yes`, se activará
automáticamente (salvo si se ha 'bajado' explícitamente antes)*

`nmcli con up midin`

> Activa la *connection* `midin` y permite que se autoconecte si estuviera
configurado para ello.  
*Si el device tenía otra connection activa, la desactiva porque solo puede tener
una connection activa.*

`nmcli con delete mdin`

> Borra la *connection* `mdin`

**`hostname -I`**

> Muestra direcciones IP asignadas al host


