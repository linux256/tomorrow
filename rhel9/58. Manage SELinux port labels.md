\newpage

## MANAGE SECURITY
# 58. Manage SELinux port labels

---

### I. Cambiar contexto de un puerto

*Un puerto no incluido en la política por defecto solo puede tener un contexto.
Si a un puerto personalizado se le intenta añadir a un segundo contexto, se
obtiene un error; y si se modifica se añade el nuevo contexto y se le retira el
antiguo.*

*Sin embargo, ya que no se pueden modificar los puertos incluidos en la política
por defecto (normalmente en los puertos bien definidos, hasta 1024), estos
puertos SÍ pueden tener mas de un contexto. Cuando se modifican no se les retira
el contexto establecido en la política por defecto. De esta forma, es posible
tener SSH en el puerto 22 y en un puerto personalizado (2022) o no (443). En 
este caso, la segunda asignación establecida, es personalizada, y tiene mas
prioridad que la asignación por la política por defecto.*

>

`semanage port -l`

> Lista los contextos de puerto definidos y a que puertos se le aplican

`semanage port -l | grep 'unreserved'`

> Lista los puertos no reservados, que estan disponibles para poder asignarles
cualquier contexto con facilidad sin interferencia con la política por defecto


`semanage port  -a  -t http_port_t  -p tcp 8080`

> Añade el contexto `h..._t` al puerto TCP/8080

`semanage port  -m  -t echo_port_t  -p tcp 2022`

> Modifica el contexto del puerto 2022 cambiándolo del que tuviera al nuevo establecido (`echo_port_t` )

`semanage port  -d  -t echo_port_t   -p tcp 2022`

> Retira el contexto `echo_port_t` al puerto 2022 (quedará sin contexto porque
al ser personalizado no podía tener dos contextos antes de ejecutar el comando)


----

*Referencias*

> *Para retirar a un puerto bien definido (`22`) un contexto (`ssh_port_t`)
es necesario definir un modulo personalizado de la política para SSH. Tendrá
más prioridad que la política por defecto.*

* https://serverfault.com/questions/857875/setting-a-port-number-inside-my-selinux-module-file

* https://www.linuxcampus.net/documentation/selinux-policy/ssh.html


