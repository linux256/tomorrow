\newpage

## MANAGE SECURITY
# 56. List and identify SELinux file and process context

---

### I. CONTEXT LABELS [EX200]

Las reglas SELinux se basan en la coincidencia entre las etiquetas de los
objetos origen (usarios, procesos) y las etiquetas de los objetos destino
(ficheros y puertos). Las etiquetas o *context labels* dependen por tanto de la
naturaleza del objeto y se pueden conocer así

* ficheros y directorios: `ls -Z`
* puertos: `ss -Ztuln`
* procesos: `ps Zaux`
* usuario: `id -Z`

>

**Context Label**

`system_u : object_r : bin_t : .... : ....`

Primero se etiqueta el usuario (`system`), luego se etiqueta el tol (`object`)
y luego se etiqueta **el tipo (`bin_t`)**. Esta última parte, es el **context
type** y es la más importante. Hay que saber establecer los **context type** en
*target domains*, a saber, en ficheros y en puertos

>

### II. MODIFICAR Y RESTABLECER CONTEXT LABELS

*`chcon`*

> *NO SE DEBE USAR. Escribe directamente en el filesystem, no en la política de
SELinux. Por tanto se pierde ante un re-etiquetado del filesystem o cuando una
política restaura el contexto original.*

`semanage`

> Escribe el nuevo contexto a la política SELinux, es la forma correcta de
hacer un cambio para que este sea persistente.

`semanage  fcontext  -a  -t httpd_sys_content_t  "/mydir(/.*)?"`

> Modifica el file context  (`fcontext`) para añadir (`-a`) el context type
(`-t`) con valor `..._t` a todos los ficheros y subdirectorios en /mydir, con
la ex.reg  `(/.*)?` donde `?: 0 ó 1` y `*: 0 ó n`

`restorecon -R -v /mydir`

> Restablece context labels del directorio `/mydir`, de manera recursiva (`-R`)
mostrando mensajes (`-v`)

>

**Paquetes de instalacion y ayuda**

`dnf install policycoreutils-python-utils       # proporciona semanage`

`dnf install selinux-policy-doc                 # proporciona documentacion`

`man semanage`

`man -k _selinux`

`man semanage-fcontext                          # ayuda context-types ficheros`


