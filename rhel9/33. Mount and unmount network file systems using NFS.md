\newpage

## CREATE AND CONFIGURE FILESYSTEMS
# 33. Mount and unmount network filesystems using NFS

---

### I. NFS

*Network File System tiene v3 y v4. RHEL solo soporta v4, pero el cliente NFS
se conectará a una versión inferior si el servidor NFS se lo ofrece. Para fijar
la version emplear la opción de montaje **`nfsver`** en `/etc/fstab`*

`dnf install nfs-utils`

> Utilidades necesarias para el servidor, y el cliente NFS

>

### II. SERVIDOR NFS

`man exports`

`/etc/exports`

> Fichero de configuración de los directorios que se quieren compartir, *shares*
> . Por defecto en NFS se aplica `root_squash` para 'aplastar' el acceso de los
> usuarios cliente `root` mapeándolos a un usuario `anonymous` de permisos
> limitados. De otra manera, cualquier usuario cliente `root` crearía ficheros
> `suid` para todos los usuarios, propagando un troyano. En producción no se
> recomienda eliminar esta medida de seguridad habilitada por defecto (se
> eliminaría aplicando `no_root_squash` en `/etc/exports`)

> `/share1   *(rw,no_root_squash)   # el '*' habilita cualquier cliente`  
> `/share2   *(rw,no_root_squash)   # 'no_root_squash' no limita usuario 'root'`

`systemctl enable --now nfs-server`

> Inicia y habilita el servidor NFS

`firewall-cmd --add-service nfs       --permanent   # puerto TCP/2049`  
`firewall-cmd --add-service rpc-bind  --permanent   # puerto TCP,UDP/111`  
`firewall-cmd --add-service mountd    --permanent   # puerto TCP,UDP/20048`  
`firewall-cmd --reload`

> Habilita servicios `nfs`, `rpc-bind` y `mountd` en configuración permanente y
> en runtime (`--reload`). La definición de puertos para `firewalld` esta en
> `/usr/lib/firewalld/services/*.xml`

>

### III. CLIENTE NFS

`showmount -e serverNFS.example.com`

> Enumera los *shares* ofrecidos por `serverNFS.example.com`

`mount serverNFS.example.com:/  /mnt`

> Otra forma de descubrir los *shares* disponibles con acceso para el usuario es 
montarlos en `/mnt`

`echo "serverNFS.example.com:/share1  /home/john  nfs  sync  0 0" >> /etc/fstab`

> Añade `share1` de servidor NFS en `/home/john` con *filesystem* tipo **`nfs`**
> y opcion **`sync`** para hacer *commit* de las escrituras inmediatamente (en
> versiones RHEL<9 la opción era `_netdev`)


