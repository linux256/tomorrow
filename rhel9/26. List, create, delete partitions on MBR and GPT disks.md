\newpage

## CONFIGURE LOCAL STORAGE
# 26. List, create, delete partitions on MBR and GPT disks

---

### I. FIRMWARE Y ESTANDARES PARA PARTICIONAR DISCOS

* ***UEFI ==> GPT***  
*Los equipos actuales incorporan firmware **UEFI** (Unified Extensible Firmware
Interface), que **solo admite particionado de discos GPT** (Globally Unique
Identifier Partition Table)*

* ***BIOS ==> MBR y GPT***  
*Los equipos antiguos y actuales soportan firmare **BIOS** (Basic Input Output
System), que **admiten particionado de discos MBR** (Master Boot Record) o 
**GPT**.*

*Consecuencia de lo anterior,* ***MBR==>BIOS*** y ***GPT =/=> UEFI***

* ***MBR vs GPT***  
En MBR se reserva el LBA 0 (primer Logical Block Address), que ocupa
512 bytes, para almacenar información de 4 particiones (2TiB máximo, 3 primarias
y 1 extendida que puede tener hasta 15 particiones lógicas) y 446 bytes para el
bootloader (solo cabe el stage "1" de GRUB).
En GPT se pueden tener hasta 128 particiones con 8ZiB. Para identificar se usa
el codigo GUID de 16 bytes ó 32 caracteres hexadecimales: 8-4-4-4-12. En Linux
se emplean por defecto unidades de almacenamiento binarias,

> `1 kibibyte = 1KiB = 2^10 bytes = 1.024`  
> `1 Mibibyte = 1Mib = 2^20 bytes = 1.048.576`  
> `1 GibiByte = 1GiB = 2^30 bytes = 1.073.741.824` *(cálculo: 2^30 | bc)*  
> `1 Tibibyte = 1TiB = 2^40 bytes = 1.099.511.627.776` *(cálculo: 2^40 | bc)*  

### II. PARTICIONADO DE DISCO: FDISK, GDISK, PARTED

El nombre que recibe "file" asociado al disco depende del tipo de disco,

* `/dev/hda` para discos ID
* `/dev/sda` para discos SCSI y discos virtuales de VMWare
* `/dev/vda` para discos virtuales KVM
* `/dev/xvda` para discos virtuales XEN
* `/dev/nvme0n1` para discos virtuales NVMe

`fdisk /dev/sdb`

> Particionado de disco MBR `sdb` con secuencia de teclas **`[P]`** (overview),
**`[N]`** (nueva particion), **`[P]`** (particion primaria), **`+1G`** (tamaño
1GiB), **`[T]`** (elegir tipo de particion), **`[W]`** (write). Los códigos de
los tipos de partición MBR son,

* **`82 LINUX SWAP`**
* **`83 LINUX`**
* **`8e LVM (LOGICAL VOLUME MANAGER)`**

>

`gdisk /dev/sdc`

> Particionado de disco GPT con secuencia de teclas **`[N]`** (nueva particion),
**`[+1GB]`** (tamaño 1GiB), **`[L]`** (listar particiones), **`[P]`** (overview)
, **`[W]`** (write). Los códigos de tipos de partición GPT son,

* **`8200 LINUX SWAP`**
* **`8300 LINUX`**
* **`8e00 LVM (LOGICAL VOLUME MANAGER)`**

>

`parted /dev/sdc`

> Permite realizar particiones, con comandos `help`, `print`, `mklabel` (para
gpt), `mkpart`, especificando tamaños 1MiB/GiB, **`quit` para aplicar cambios**.
El comando `set 2 lvm on` activa el tipo (*flag*) LVM en la partición con ID 2.

`partprobe`

> Tras realizar cambios en disco, `partprobe` actualiza la tabla de particiones
> e informa al kernel

### III. LISTADO DE DISPOSITIVOS DE BLOQUES: LSBLK Y BLKID

`blkid`

> Muestra atributos de los dispositivos de bloques leyendo directamente de ellos
> por lo que **requiere ser ejecutado como `root`**. Proporciona información
> siempre cierta.

`lsblk`

> Proporciona información de los dispositivos de bloques a través de `udevd` (si
> no se ejecuta como `root`) por lo que puede haber discrepancia entre lo
> realizado y lo mostrado por `lsblk`. Si se ejecuta como `root` recupera la
> informacion de los dispositivos accediendo a ellos (como hace `blkid`)

`lsblk -o +PARTUUID,UUID`

> Agrega (`-o +...,...`) **UUID de la partición** y **UUID del filesystem**. En
`/etc/fstab` se emplea el **UUID del sistema de ficheros**

`lsblk -po TYPE,TRAN,MODEL,SERIAL,SIZE,NAME,KNAME,FSTYPE,FSUSE%,MOUNTPOINTS`

> Omite la salida por defecto y emplea los campos indicados, para identificar
> aspectos hardware (disco o partición, tipo, modelo, tamaño, seguido de datos
> del sistema de ficheros). Al usar `-p` se incluye el PATH en el NAME

---

*Referencias*

* https://www.system-rescue.org/disk-partitioning/Grub-boot-stages/


