\newpage

## CONFIGURE LOCAL STORAGE
# 30. Configure systems to mount filesystems at boot by UUID or label

---

### I. MONTAJE DE SISTEMAS DE FICHEROS

*Montar un sistema de ficheros existente en una particioń o volumen lógico,
logra que su contenido esté disponible en un directorio. Se deben espedificar
cuatro cosas:*

***QUÉ montar** + **DÓNDE montarlo** + **FILESYSTEM contenido** + **OPCIONES 
adicionales***

>

`mount  QUEMONTAR          DONDEMONTAR`  
`mount  /dev/vg00/lvdata   /mnt/datos/`

> Monta el contenido especificado en el directorio indicado

***Métodos de identificación independientes recomendados para el montaje***

`mount  LABEL=rhel9  /mnt/datos/`

> Monta el sistema de ficheros con `LABEL=rhel9`

`mount  UUID=5b320e9d-....8e4a  /mnt/datos/`

> Monta el sistema de ficheros con `UUID=...`

`mount  PARTLABEL=ssd1  /mnt/datos/`

> Monta el sistema de ficheros contenido en la partición con `PARTLABEL=...`

`mount  PARTUUID=5a4420a... /mnt/datos/`

> Monta el sistema de ficheros contenido en la partición con `UUID=...`. *No se
> recomienda emplear `ID=...` que es el identificador del dispositivo de bloques
> hardware porque este es un dato generado por `udevd` y, aunque se emplean
> datos del hardware como su WWW que viene asignado por el fabricante, depende
> en última instancia de lo que `udevd` calcule. No se deben emplear por tanto
> ID desde `/dev/disk/by-id`*

`umount /dev/sda1`  
`umount /mnt/datos/`

> Desmonta el sistema de ficheros contenido en `/dev/sda1`. También se puede
> indicare que desmonte el sistema de ficheros montado en `/mnt/datos/`

### II. FICHERO DE MONTAJE AUTOMATICO

`/etc/fstab`

> Tabla con los sistemas de ficheros que se deben montar automaticamente en el
> arranque del sistema. Cada entrada debe tener estos campos,

* `LABEL` ó `UUID` ó `PARTLABEL` ó `PARTUUID` para identificar el *filesystem*
* `/ruta/puntomontaje/` para conocer el directorio donde se montará
* `xfs` ó `ext4` ... para conocer el tipo del *filesystem* a montar
* `defaults` u `opciones` opciones de montaje, dependerán del tipo de fs, v.g.:
* `0` para determinar si el *filesystem* debe ser respaldado por `dump`
* `0` para indicar que el *filesystem* no se chequee en el siguiente arranque.
Si se desea chequear, se debe poner 1 al *filesystem* `/` para que tenga mayor
prioridad y 2 a otros *filesystems* que se quieran chequear.

Algunas opciones de montaje que se pueden especificar:

`man mount`

> * `ro` ó `rw` para montar en solo lectura o lectura/escritura
> * `exec` ó `noexec` para poder ejecutar (o no) ficheros de este *filesystem* 
> * `auto` ó `noauto` para montar (o no) al invocar `mount -a`
> * `acl`, `usr_xattr`, `atime`/`noatime`, `suid`/`nosuid`, `nofail`

**`findmnt --verify`**

> Permite verificar la sintaxis de `/etc/fstab` ya que un fallo en este fichero
> produce un error en el arranque de sistema que se debe corregir

**`mount -a`**

> Monta todos los sistemas de ficheros que no esté previamente montados, lo que
> permite verificar que `/etc/fstab/` funcionará. Este es modo mas seguro de
> verificar, *siempre que (1) no se hayan montado manualmente antes las nuevas
> entradas añadidas ni (2) se hayan modificado líneas de filesystems montados.
> En cualquiera de estos dos casos `mount -a` no comprobará nada.* 

**`blkid`**

> Ejecutado como root, consulta a los dispositivos de bloques sus parámetros,
> incluidos el UUID de los *filesystems* antes de editar `/etc/fstab` o montar

**`lsblk -o +FSTYPE,LABEL,UUID`**

> Muestra el tipo de *filesystem* su etiqueta y su UUID para montar

`df -h` 

> Muestra información de los *filesystem* montados, para comprobar el resultado
> de `mount -a`

### III. MONTAJE DESDE SYSTEMD

*El empleo de systemd reemplaza el empleo de `/etc/fstab` por **mount units**. 
Los montajes definidos en `/etc/fstab/` se reconstruyen automáticamente.
Comprobar esta generación automática antes de reiniciar, es una opción
complementaria a usar **mount -a** para comprobar un cambio hecho al fichero
`/etc/fstab`*

>

`/run/systemd/generator/*.mount`

> Ficheros de las **unit mount** generados automáticamente desde `/etc/fstab`

**`systemctl daemon-reload`**

> Recrea todos los archivos `.mount` de `/run/systemd/generator/`

`systemctl status /boot`

> Muestra estado del punto de montaje `/boot` 

`systemctl start /boot`

> Monta el *filesystem* con destino `/boot` 

`man systemd.mount`

> Ayuda sobre las mount unit, definidas por ficheros en `/etc/systemd/system/`
> cuyo nombre determina donde se montarán, y con el siguiente contenido:

>

**Contenido de `/etc/systemd/system/mnt-midir.mount`**

> ***`[Unit]`***  
> `Before=local-fs.target`  
> ***`[Mount]`***  
> `What=/dev/disk/by-uuid/....`  
> `Where=/mnt/midir`  
> `Type=xfs`  
> ***`[Install]`***  
> `WantedBy=multi-user.target`

`systemctl enable --now mnt-midir.mount` 

> Monta la unit `/etc/systemd/system/mnt-midir.mnt` y lo habilita en el *target*
> `multi-user.target`


