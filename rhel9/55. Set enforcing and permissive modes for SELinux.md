\newpage

## MANAGE SECURITY
# 55. Set enforcing and permissive modes for SELinux

---

### I. SELINUX

SELinux es un sistema MAC (Mandatory Access Control) donde todo está prohibido
salvo lo expresamente permitido con *políticas*. Puede haber varias políticas
definidas en el sistema, pero solo puede estar activa una.

Una *política* es un conjunto de *reglas*

Una *regla* es una declaración en la que un *source domain* puede acceder a un
*target domain*, y están definidos en base a *etiquetas de contexto*

Los *source domain* son los objetos que pueden acceder: un usuario o un proceso

Los *target domain* son los objetos accedidos: ficheros/directorios o puertos

Las *context label* permiten categorizar los objetos

*Politica* es un conjunto de *reglas* de acceso definidas por *context label*
que establecen que *source domain* pueden acceder a que *target domain* 

SELinux está integrado en el kernel y solo se puede deshabilitar *completamente*
mediante un parámetro del kernel. Las aplicaciones deben estar preparadas para
emplear SELinux o reciben un tratamiento por defecto. SELinux puede estar en 4
posibles estados, de mayor a menor nivel de aplicación:

* ENABLED **ENFORCING**: se deniegan los accesos que la política estableza y se
registran.

* ENABLED **PERMISSIVE**: se permiten los accesos que la política estableza,
pero se registran. Los registros en modo *permissive* no son necesariamente
coincidentes con los registros en *enforcing* (la política puede denegar un
acceso tras un número de otras denegaciones, o una aplicación puede cambiar de
comportamiento tras una denegación)

* **DISABLED**: se deshabilita la mayoría del código de SELinux en el Kernel y
en las aplicaciones. SELinux sigue presente pero NO HAY ninguna política 
cargada. Siguen activándose por ejemplo los *hooks* en las aplicaciones
auque no haya política alguna, lo que puede modificar su comportamiento.

* **FULLY DISABLED**: no se ejecuta nada en el kernel ni en las aplicaciones
referente a SELinux.

>

`/var/log/audit.log`

> Fichero en el que se registran los mensajes de SELinux

`/etc/sysconfig/selinux`

> Fichero en que se define el modo salvo *full disabled*, **`SELinux=enforcing
| permissive | disabled`**

>

### II. DESHABILITAR COMPLETAMENTE SELINUX [EX200]

Establecer `SELINUX=disabled` en `/etc/selinux/config` **no deshabilita**
completamente SELinux. Para deshabilitar completamente SELinux se debe indicar
en el kernel mediante el parámetros `selinux=0`. Este parámetro se puede fijar,

* De manera **temporal**, accediento en GRUB a los parámetros de inicio del
kernel y añadiendo **`selinux=0`**

* De manera **permanente**, modificando el fichero de configuración principal
de GRUB, de dos modos:

> *Opción 1: empleando `grubby`*

> > **`grubby  --update-kernel ALL  --args selinux=0`**, añade *kernel option*
persistente

> *Opción 2: editando `/etc/default/grub` y recreando `grub.cfg` con `grub2-
mkconfig`*

> > editar `/etc/default/grub` y añadir en la línea del kernel `selinux=0`  

> > **`grub2-mkconfig --update-bls-cmdline -o /boot/efi/EFI/redhat/grub.cfg`**
>

### III. MODIFICAR ESTADO DE MANERA PERMANENTE Y TEMPORAL

Salvo el modo *full disabled* (que se establece con la opción de arranque del
kernel `selinux=0`) los demas modos se establecen de modo **permanente**
con el valor del parámetro **`SELINUX`** en `/etc/selinux/config`. El modo
*permissive* también se puede fijar de modo permanente con el parametro de
inicio del kernel `enforcing=0`

>

Para modificar **temporalmente** el estado de SELinux se emplea,

* `setenforce 0`

> Fija temporalmente el modo *permissive*

* `setenforce 1`

> Fija temporalmente el modo *enforcing*

>

`getenforce`

> Muestra el estado actual de SELinux

`sestatus -v`

> Muestra información detallada del estado de SELinux


