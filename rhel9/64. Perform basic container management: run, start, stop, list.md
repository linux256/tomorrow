\newpage

## MANAGE CONTAINERS
# 64. Perform basic container management: running, starting, stopping, listing

---

### I. LISTADO

`podman ps`

> Enumera contenedores en activo

`podman ps -a`

> Enumera todos los contenedores del usuario, activos y parados

>

### II. INICIO Y PARADA

`podman start nombreCont`

> Inicia un contenedor detenido

`podman stop nombreCont`

> Envía inmediatamente la señal `SIGTERM` al contenedor `nombreCont`, si después
de 10 segundos sigue activo envía la señal `SIGKILL`

`podman kill nombreCont`

> Envía inmediatamente la señal `SIGKILL` al contenedor `nombreCont`

`podman restart nombreCont`

> Reinicia el contenedor `nombreCont`

`podman pause nombreCont`

> Pausa todos los procesos en `nombreCont`

`podman unpause nombreCont`

> Continua todos los procesos en `nombreCont`

>

### III. EJECUCION DE CONTENEDORES Y COMANDOS

`podman run nombreCont`

> Ejecuta el contenedor `nombreCont`

`podman run -d nombreCont`

> Ejecuta el contenedor `nombreCont` de manera *deattached*

`podman run -it nombreCont`

> Ejecuta el contenedor `nombreCont` conectándose a su *TTY*

`podman run nombreCont  cmd`

> Ejecuta el comando `cmd` en el contenedor `nombreCont` en lugar de su comando
por defecto

`podman run --rm nombreCont`

> Ejecuta el contenedopr `nombreCont` y lo borra cuando termina su ejecución

>

### IV. LIMPIEZA DEL ENTORNO

`podman rm nombreCont`

> Borra el contenedor `nombreCont`

`podman rm -a`

> Borra todos los contenedores que puede (los activos no los puede borrar)

`podman system prune`

> Limpia todo el sistema de contenedores: imágenes, contenedores,...

`podman system reset`

> Restablece todo el almacenamiento

### V. CONSTRUCCION DE IMAGENES DESDE CERO CON BUILDAH

En lugar de partir de una imagen base existente, se pueden copiar los ficheros
requeridos y su configuración para obtener un contenedor mínimo. Para usar
`dnf`, `yum`, `rpm`, hay que inicializar una base de datos RPM y añadir los
paquetes requeridos.

```
                # PASO 1. Creacion imagen vacía
                # -----------------------------
dnf install container-tools                 #instala herramientas requeridas
buildah from scratch                        #crea imagen 'working-container`
ruta=$(buildah mount working-container)     #monta imagen y guarda su ruta

                 # PASO 2. Configuracion de la aplicacion
                 # --------------------------------------
                 # inicializa bbdd rpm y agrega paquetes 'redhat-release, httpd'
yum install -y   --releasever=9       --installroot=$ruta    redhat-release
yum install -y   --setopt=reposdir=/etc/yum.repos.d     \
                 --setopt=cachedir=/var/cache/dnf       \
                                      --installroot=$ruta    httpd

mkdir -p $ruta/var/www/html && cd $_        #crea dir ficheros html y se cambia
echo "Hello world!" >> index.html           #usar "$_ " si $ruta tiene espacios

                 # PASO 3. Configuración de la imagen
                 # ----------------------------------
                 # se establece que comando ejecutar y que puerto emplear
                 # se consolidan cambios en la imagen local 'mihttpd:latest"
buildah config   --cmd  "/usr/sbin/httpd -DFOREGROUND"  working-container
buildah config   --port 80/tcp                          working-container
buildah commit   working-container   localhost/mihttpd:latest

                 # PASO 4. Verificacion y prueba
                 # -----------------------------
podman images
podman run -d  -p 8080:80  --name miservidorweb  localhost/mihttpd:latest
curl localhost:8080
```

---

*Referencias*

* https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html/
building_running_and_managing_containers/assembly_building-container-images-
with-buildah#proc_creating-images-from-scratch-with-buildah_assembly_building-
container-images-with-buildah

* https://www.server-world.info/en/note?os=CentOS_Stream_9&p=buildah&f=2 


