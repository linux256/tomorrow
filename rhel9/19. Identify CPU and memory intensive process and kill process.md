\newpage

## OPERATE RUNNING SYSTEMS
# 19. Identify CPU and memory intensive process and kill processes

---

### I. PRIORIDAD

`nice -n5 comando`

> Inicia `comando` con nivel `nice=niceDefecto+5` es decir `0+5=5`. Solo `root`
> puede iniciar con `nice<0`, es decir con prioridad superior a la establecido
> por defecto

`renice -n5 -p 234`

> Ajusta `nice` del proceso 234

### II. ENVIO DE SEÑALES A LOS PROCESOS. KILL, KILLALL, PKILL

`man 7 signal`

> Información de las señales existentes. Por ejemplo `SIGHUP(1), SIGKILL(9),`
> `SIGTERM(15)`

`kill -l`

> Lista las señales

`kill pid`

> Envia SIGTERM al proceso 9

`kill -9 pid`

> Envía SIGKILL al proceso 9

`kill -9 -6734`

> Envía SIGKILL a todos los procesos cuyo PROCESSGROUPID es 6734

`kill -- -6734`

> Envía SIGTERM a todos los procesos cuyo PROCESSGROUPID es 6734. El argumento
> `--` indica a bash que se han terminado las opciones del comando `kill` (la
> señal a enviar es un argumento opcional)

`killall httpd`

> Envía SIGTERM a todos los procesos con nombre `httpd`

`killall -s9 httpd`

> Envía SIGKILL a todos los procesos con nombre `httpd`

`pkill -9 patron`

> Envía SIGKILL a todos los procesos cuyo nombre se ajusta a `patron`

`pkill -s SESIONID`

> Envía SIGKILL a todos los procesos que pertenezcan a la sesión `SESIONID`

`ps j`

> Lista los procesos mostrando PROCESSGROUPID y SESSIONID

### III. LIMPIAR UN PROCESO ZOMBIE

`ps aux | grep defunct`

> Localiza procesos zombie (que han terminado pero su parent no los desaloja de
> la tabla de procesos; no estan consumiendo recursos pero no se han borrado de
> la lista de procesos que Linux mantiene). Cuando un proceso termina, el kernel
> envia SIGCHLD al parent del proceso. El parent entonces ejecuta una llamada a
> la funcion `wait()` del sistema para leer el estado del proceso hijo y su exit
> code. Esto elimina la entrada del proceso hijo de la tabla de procesos y el
> proceso hijo desaparece definitivamente.

> Si un proceso no esta programado para invocar a `wait()` al crear procesos
> hijos, o no es capaz de gestionar la señal SIGCHLD que le enviará el kernel,
> se generarán procesos zombie.

> El comando `top` enumera la cantidad de procesos zombie en su primera línea

`kill -SIGCHLD parentZombieID`

> Envía señal SIGCHILD al proceso parent de un proceso zombie lo que puede
> disparar la función `wait()` necesaria para limpiar el proceso zombie. Si esto
> no funciona, otra alternativa es matar el proceso padre del zombie, con lo que
> systemd pasa a ser el padre de los zombies y ejecuta `wait()`. Si PPID de los
> procesos zombies es 1 (systemd) se debe reiniciar el sistema.

### IV. COMANDO TOP

`uptime`

> Muestra media de carga en 1, 5 y 15 minutos

`lscpu`

> Muestra número de CPU y número de cores por CPU

`top`

> Muestra procesos en ejecucion y su actividad, con respuesta a los comandos,

* `k` kill, mata el proceso
* `r` renice, ajusta la 'bondad (nice)' del proceso (sumando, resta prioridad)
* `1` muestra cores
* `z` color
* `c` muestra comando completo
* `v` muestra jerarquia de procesos
* `f` selector de campos
>

* `x` resalta la columna para ordenar
* `b` muestra la columna por la que se ordena en video inverso
* `R` ordena en orden reverso
* `<` selecciona columna de la izquierda para ordenar
* `>` selecciona columna de la derecha para ordenar
* `SHIFT-p` ordena por processador (CPU)
* `SHIFT-m` ordena por memoria (RAM)
* `SHIFT-n` ordena por PID
* `SHIFT-t` ordena por tiempo de ejecución


